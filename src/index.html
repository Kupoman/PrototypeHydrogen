<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Prototype Hydrogen</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <template id="mechcard">
        <div class="mechcard panel panel-default col-sm-2" id="mc">
            <div class="panel-heading">
                <h4 class="mechname"></h4>
            </div>
            <div class="panel-body">
                <div class="progress">
                    <div class="mechhealth progress-bar progress-bar-danger" role="progressbar"></div>
                </div>
                <p>
                    <span class="mechweaponname"></span>
                    <span class="mechcore"></span>
                </p>
                <div class="progress">
                    <div class="mechweaponres progress-bar" role="progressbar"></div>
                </div>
                <table class="table">
                    <tr>
                        <td><span class="glyphicon glyphicon-cutlery"></span></td>
                        <td class="mechstatattack"></td>

                        <td><span class="glyphicon glyphicon-tower"></span></td>
                        <td class="mechstatdefense"></td>
                    </tr>
                    <tr>
                        <td><span class="glyphicon glyphicon-record"></span></td>
                        <td class="mechstataccuracy"></td>

                        <td><span class="glyphicon glyphicon-hourglass"></span></td>
                        <td class="mechstatspeed"></td>
                    </tr>
                </table>
            </div>
        </div>
    </template>

    <template id="enemypic">
        <div class="enemypic">
            <div class="progress">
                <div class="enemyhealth progress-bar progress-bar-danger" role="progressbar"></div>
            </div>
            <img src="/images/enemy.png">
        </div>
    </template>

    <div id="menu-page" class="page">
        <div class="page-header">
            <h1>Prototype Hydrogen</h1>
        </div>

        <ul class="nav nav-pills nav-stacked">
            <li><a href="do_combat">Begin Combat</a></li>
            <li><a href="do_customize">Customize Mechs</a></li>
        </ul>

        <div id="player-stats" class="well">
            <p>Wins: <span id="player-stats-wins"></span></p>
        </div>
    </div>

    <div id="mech-list-page" class="page">
        <div class="page-header">
            <h1>Mechs</h1>
        </div>

        <ul id="mech-status-list" class="nav nav-pills nav-stacked">
        </ul>

        <a href="do_button_main" class="btn btn-primary">Go back</a>
    </div>

    <div id="mech-status-page" class="page">
        <div class="page-header">
            <h1>Mech Status: <small id="mech-status-name"></small></h1>
        </div>

        <div class="navbar">
            <ul id="mech-status-formations" class="nav nav-tabs">
            </ul>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div id="mech-status-itemdesc" class="col-sm-8">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Item Information
                        </div>
                        <div class="panel-body">
                            <p></p>
                        </div>
                    </div>
                </div>

                <div id="mech-status-block" class="col-sm-4">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Stats
                        </div>
                        <div class="panel-body">
                            <table class="table">
                                <tr>
                                    <td><span class="glyphicon glyphicon-cutlery"></span></td>
                                    <td class="mechstatattack"></td>

                                    <td><span class="glyphicon glyphicon-tower"></span></td>
                                    <td class="mechstatdefense"></td>
                                </tr>
                                <tr>
                                    <td><span class="glyphicon glyphicon-record"></span></td>
                                    <td class="mechstataccuracy"></td>

                                    <td><span class="glyphicon glyphicon-hourglass"></span></td>
                                    <td class="mechstatspeed"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div id="mech-status-pitems" class="col-sm-4">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Available Items
                        </div>
                        <div class="panel-body">
                            <ul class="nav nav-pills nav-stacked">
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="mech-status-mitems" class="col-sm-4">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Mech Items
                        </div>
                        <div class="panel-body">
                            <ul class="nav nav-pills nav-stacked">
                                <li><a href="">Nice Item</a></li>
                                <li><a href="">Better Item</a><li>
                                <li><a href="">Some Junk</a><li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="mech-status-mitemset" class="col-sm-4">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Current Item Set
                        </div>
                        <div class="panel-body">
                            <ul class="nav nav-pills nav-stacked">
                                <li><a href="">Nice Item</a></li>
                                <li><a href="">Better Item</a><li>
                                <li><a href="">Some Junk</a><li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <a href="do_customize" class="btn btn-primary">Go back</a>
    </div>

    <div id="combat-page" class="page">
        <div class="container-fluid">
            <div id="mechlist" class="row">
                <div class="panel panel-default col-sm-2 command-list">
                    <div class="panel-heading">
                        <h3>Commands</h3>
                    </div>
                    <div class="panel-body">
                        <ul class="nav nav-pills nav-stacked">
                            <li><a href="do_attack">Attack</a></li>
                            <li><a href="do_change_formation">Change Formation</a></li>
                            <!-- <li class="nav-divider"></li>
                            <li><a href="#">Formation Alpha</a></li>
                            <li><a href="#">Formation Beta</a></li>
                            <li><a href="#">Formation Gamma</a></li>
                            <li class="nav-divider"></li> -->
                            <li><a href="do_run">Run</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
    <script src="js/engine_stub.js"></script>

    <script>
        var _ui_lock = false

        lock_ui = function (enable) {
            _ui_lock = enable
        }

        $('a').click(function (evt) {
            evt.preventDefault()
            if (!_ui_lock) {
                Engine.do_action($(this).attr('href'))
            }
        })

        update_player = function (player) {
            $('#player-stats-wins').text(player.wins)
        }

        update_saves = function (saves) {
        }

        animate_mech = function (mech, anim) {
            var mechid,
                dfrd

            mechid = '#mc' + mech.id

            if ($(mechid).length === 0) {
                mechid = '#en' + mech.id
            }

            dfrd = $.Deferred()
            $(mechid).addClass('animated ' + anim)
            $(mechid).one('animationend', function () {
                $(this).removeClass('animated ' + anim)
                dfrd.resolve()
            })

            return dfrd.promise()
        }

        update_mech = function (mech) {
            var mechid = '#mc' + mech.id,
                weapon = mech.item_sets[mech.current_item_set].weapon
            $(mechid + ' .mechname').text(mech.name)
            if (mech.core === 'fire') {
                $(mechid + ' .mechcore').addClass('glyphicon glyphicon-fire')
            }
            else if (mech.core === 'lightning') {
                $(mechid + ' .mechcore').addClass('glyphicon glyphicon-flash')
            }
            else if (mech.core === 'earth') {
                $(mechid + ' .mechcore').addClass('glyphicon glyphicon-leaf')
            }
            else if (mech.core === 'water') {
                $(mechid + ' .mechcore').addClass('glyphicon glyphicon-tint')
            }
            $(mechid + ' .mechhealth').css('width', (mech.hp_current * 100 / mech.hp_max) + '%')
            $(mechid + ' .mechhealth').text(mech.hp_current + '/' + mech.hp_max)
            $(mechid + ' .mechweaponname').text(weapon.name)
            $(mechid + ' .mechweaponres').css('width', (mech.resource_current[weapon.key] * 100 / weapon.resource_max) + '%')
            $(mechid + ' .mechweaponres').text(mech.resource_current[weapon.key] + '/' + weapon.resource_max)
            $(mechid + ' .mechstatattack').text(mech.stats.attack + '(+' + weapon.damage + ')')
            $(mechid + ' .mechstataccuracy').text(mech.stats.accuracy + '(+' + weapon.accuracy + ')')
            $(mechid + ' .mechstatdefense').text(mech.stats.defense + '(+' + weapon.defense + ')')
            $(mechid + ' .mechstatspeed').text(mech.stats.speed + '(+' + weapon.speed + ')')

            if (mech.hp_current <= 0) {
                $(mechid).removeClass('panel-default')
                $(mechid).addClass('panel-danger')
            }
        }

        add_mech = function (mech) {
            var template,
                clone;

            template = document.querySelector('#mechcard')
            clone = document.importNode(template.content, true)
            clone.querySelector('.mechcard').id = 'mc' + mech.id
            document.body.querySelector('#mechlist').appendChild(clone)

            update_mech(mech)
        }

        update_enemy = function (enemy) {
            var enemyid = '#en' + enemy.id

            $(enemyid).css('left', enemy.left + '%')
            $(enemyid).css('bottom', enemy.bottom + '%')

            $(enemyid + ' .enemyhealth').css('width', (enemy.hp_current * 100 / enemy.hp_max) + '%')

            if (enemy.hp_current <= 0) {
                $(enemyid).fadeOut({
                    duration: 400,
                    complete: function () {
                        $(this).remove()
                    }
                })
            }
        }

        add_enemy = function (enemy) {
            var template,
                clone

            template = document.querySelector('#enemypic')
            clone = document.importNode(template.content, true)
            clone.querySelector('.enemypic').id = 'en' + enemy.id
            document.body.appendChild(clone)

            update_enemy(enemy)
        }

        update_mech_list = function (player) {
            var mechs = player.mechs
            $('#mech-status-list').empty()

            mechs.forEach(function (mech) {
                $('#mech-status-list').append('<li><a href="' + mechs.indexOf(mech) +  '">' + mech.name + '</a></li>')
            })

            $('#mech-status-list a').click(function (evt) {
                var mech = mechs[$(this).attr('href')],
                    weapon = mech.item_sets[mech.current_item_set].weapon
                evt.preventDefault()
                Engine.render('mech-status')

                // Formations
                $('#mech-status-formations').empty()
                Object.keys(mech.item_sets).forEach(function (item_set) {
                    $('#mech-status-formations').append('<li><a href="">' + item_set + '</a></li>')
                })
                $('#mech-status-formations li:first').addClass('active')

                // Stats
                $('#mech-status-page .page-header small').text(mech.name)
                $('#mech-status-page .mechstatattack').text(mech.stats.attack)
                $('#mech-status-page .mechstataccuracy').text(mech.stats.accuracy)
                $('#mech-status-page .mechstatdefense').text(mech.stats.defense)
                $('#mech-status-page .mechstatspeed').text(mech.stats.speed)

                // Gear - General
                display_description = function (parent, item) {
                    $('#mech-status-pitems li').removeClass('active')
                    $('#mech-status-mitems li').removeClass('active')
                    $('#mech-status-mitemset li').removeClass('active')
                    parent.addClass('active')
                    $('#mech-status-itemdesc p').text(item.name)
                }

                // Gear - Player Items
                $('#mech-status-pitems ul').empty()
                player.items.forEach(function (item, idx) {
                    $('#mech-status-pitems ul').append(
                        '<li><a href="' + idx + '"">' + item.name + '</a></li>'
                    )
                })
                $('#mech-status-pitems a').click(function (evt) {
                    var item = player.items[$(this).attr('href')]
                    evt.preventDefault()
                    display_description($(evt.target).parent(), item)
                })
                $('#mech-status-pitems li:first a').click()

                //$('#mech-status-page #gear-weapon span').text(weapon.name)
                //$('#mech-status-page #gear-core span').text(mech.core)
            })
        }
    </script>

  </body>
</html>
